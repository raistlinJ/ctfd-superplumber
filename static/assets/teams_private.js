import{C as o,M as r,c as f,m as g}from"./index.js";import{s as l,c as v}from"./clipboard.33a34dfd.js";import{g as C}from"./userscore.6c40dd81.js";import{e as M}from"./index.1cf73b05.js";import"./echarts.128204f2.js";const T=()=>window.Alpine||g,d=()=>({success:null,error:null,initial:null,errors:[],init(){this.initial=l(this.$el.querySelector("form"))},async updateProfile(){this.success=null,this.error=null,this.errors=[];let e=l(this.$el,this.initial,!0);e.fields=[];for(const s in e)if(s.match(/fields\[\d+\]/)){let a={},n=parseInt(s.slice(7,-1));a.field_id=n,a.value=e[s],e.fields.push(a),delete e[s]}let t=await o.pages.teams.updateTeamSettings(e);t.success?(this.success=!0,this.error=!1,setTimeout(()=>{this.success=null,this.error=null},3e3)):(this.success=!1,this.error=!0,Object.keys(t.errors).map(s=>{const a=t.errors[s];this.errors.push(a)}))}}),m=()=>({success:null,error:null,errors:[],async updateCaptain(){this.success=null,this.error=null,this.errors=[];let e=l(this.$el,null,!0),t=await o.pages.teams.updateTeamSettings(e);t.success?window.location.reload():(this.success=!1,this.error=!0,Object.keys(t.errors).map(s=>{const a=t.errors[s];this.errors.push(a)}))}}),c=()=>({copy(){v(this.$refs.link)}}),u=()=>({errors:[],async disbandTeam(){this.errors=[];let e=await o.pages.teams.disbandTeam();e.success?window.location.reload():this.errors=e.errors[""]}}),h=()=>({captain:!1,editTeam(){this.teamEditModal=new r(document.getElementById("team-edit-modal")),this.teamEditModal.show()},chooseCaptain(){this.teamCaptainModal=new r(document.getElementById("team-captain-modal")),this.teamCaptainModal.show()},async inviteMembers(){const e=await o.pages.teams.getInviteToken();if(e.success){const t=e.data.code,s=`${window.location.origin}${o.config.urlRoot}/teams/invite?code=${t}`;document.querySelector("#team-invite-modal input[name=link]").value=s,this.$store.inviteToken=s,this.teamInviteModal=new r(document.getElementById("team-invite-modal")),this.teamInviteModal.show()}else Object.keys(e.errors).map(t=>{const s=e.errors[t];alert(s)})},disbandTeam(){this.teamDisbandModal=new r(document.getElementById("team-disband-modal")),this.teamDisbandModal.show()}}),p=()=>({solves:null,fails:null,awards:null,solveCount:0,failCount:0,awardCount:0,getSolvePercentage(){const e=this.solveCount+this.failCount;return e?(this.solveCount/e*100).toFixed(2):0},getFailPercentage(){const e=this.solveCount+this.failCount;return e?(this.failCount/e*100).toFixed(2):0},getCategoryBreakdown(){var a,n;if(!((n=(a=this.solves)==null?void 0:a.data)!=null&&n.length))return[];const e=[],t={};this.solves.data.forEach(i=>{e.push(i.challenge.category)}),e.forEach(i=>{i in t?t[i]+=1:t[i]=1});const s=[];for(const i in t)s.push({name:i,count:t[i],percent:(t[i]/e.length*100).toFixed(2),color:f(i)});return s},async init(){this.solves=await o.pages.teams.teamSolves("me"),this.fails=await o.pages.teams.teamFails("me"),this.awards=await o.pages.teams.teamAwards("me"),this.solveCount=this.solves.meta.count,this.failCount=this.fails.meta.count,this.awardCount=this.awards.meta.count;let e=window.teamScoreGraphChartOptions;M(this.$refs.scoregraph,C(o.team.id,o.team.name,this.solves.data,this.awards.data,e))}}),w=()=>{const e=T();!e||(e.store("inviteToken")||e.store("inviteToken",""),e.data("TeamEditModal",d),e.data("TeamCaptainModal",m),e.data("TeamInviteModal",c),e.data("TeamDisbandModal",u),e.data("CaptainMenu",h),e.data("TeamGraphs",p),window.TeamEditModal=d,window.TeamCaptainModal=m,window.TeamInviteModal=c,window.TeamDisbandModal=u,window.CaptainMenu=h,window.TeamGraphs=p)};window.Alpine?w():document.addEventListener("alpine:init",w,{once:!0});
