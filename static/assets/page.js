import{C,m as b}from"./index.js";const v=""+new URL("coin.5eb58d7d.svg",import.meta.url).href,$=""+new URL("star.9c945d4c.svg",import.meta.url).href,L=""+new URL("mushroom.44406eb8.svg",import.meta.url).href,_=""+new URL("fire-flower.b4c5af98.svg",import.meta.url).href,T=10,k=5,x=1400,O=2600,P=12,f=[{name:"star",src:$,min:32,max:58},{name:"coin",src:v,min:30,max:48},{name:"mushroom",src:L,min:40,max:60},{name:"flower",src:_,min:36,max:56}],y=30*1e3,D=2*60*1e3,d=new Map,c={data:null,timestamp:0,promise:null};let u=!1,h=!1;const S=window.matchMedia("(prefers-reduced-motion: reduce)");function U(){let t=document.querySelector(".mario-coin-container");return t||(t=document.createElement("div"),t.className="mario-coin-container",document.body.appendChild(t)),t}function w(t){const n=document.createElement("span");n.className="mario-coin",n.style.left=`${Math.random()*100}%`,n.style.bottom=`${Math.random()*-30}px`;const e=5+Math.random()*3;n.style.animationDuration=`${e}s`,t.appendChild(n);const a=()=>{n.removeEventListener("animationend",a),n.remove()};n.addEventListener("animationend",a)}function p(t){const n=document.createElement("span");n.className="mario-star",n.style.left=`${Math.random()*100}%`,n.style.bottom=`${Math.random()*-40}px`;const e=6+Math.random()*4;n.style.animationDuration=`${e}s`,t.appendChild(n);const a=()=>{n.removeEventListener("animationend",a),n.remove()};n.addEventListener("animationend",a)}function N(){if(u||S.matches){u=!0;return}u=!0;const t=U();for(let n=0;n<4;n+=1)w(t);for(let n=0;n<2;n+=1)p(t);setInterval(()=>{document.hidden||t.querySelectorAll(".mario-coin").length<T&&w(t)},x),setInterval(()=>{document.hidden||t.querySelectorAll(".mario-star").length<k&&p(t)},O)}S.addEventListener("change",t=>{t.matches||N()});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g,{once:!0}):g();function V(){let t=document.querySelector(".mario-floating-icons");return t||(t=document.createElement("div"),t.className="mario-floating-icons",document.body.appendChild(t)),t}function q(t){for(let n=0;n<20;n+=1){const e=8+Math.random()*74,a=4+Math.random()*92;if(!t.some(o=>{const s=o.left-a,i=o.top-e;return Math.sqrt(s*s+i*i)<10}))return{top:e,left:a}}return{top:10+Math.random()*70,left:6+Math.random()*88}}function R(){if(h)return;h=!0;const t=V(),n=[],e=P;for(let a=0;a<e;a+=1){const r=f[a%f.length],o=document.createElement("img");o.src=r.src,o.alt="",o.loading="lazy",o.decoding="async",o.className=`mario-floating-icon mario-floating-icon--${r.name}`;const s=r.min+Math.random()*(r.max-r.min);o.style.width=`${s}px`;const i=q(n);n.push(i),o.style.top=`${i.top}%`,o.style.left=`${i.left}%`;const m=7+Math.random()*6;o.style.animationDuration=`${m}s`,o.style.animationDelay=`${Math.random()*3}s`,t.appendChild(o)}}function g(){R(),N(),E()}function E(){var a,r;const t=document.querySelector(".js-mario-score"),n=document.querySelector(".js-mario-rank");if(!t&&!n)return;if(!Boolean(((a=window==null?void 0:window.init)==null?void 0:a.userId)||((r=window==null?void 0:window.init)==null?void 0:r.teamId))){if(t){const o=Number(t.dataset.marioScore||0);t.textContent=M(o)}n&&(n.textContent=I(Number(n.dataset.marioRank||0)));return}j(t,n)}async function j(t,n){var a,r,o,s;const e=B();if(!!e)try{const i=await z(e.account),m=Number((s=(o=(a=i==null?void 0:i.data)==null?void 0:a.score)!=null?o:(r=t==null?void 0:t.dataset)==null?void 0:r.marioScore)!=null?s:0),l=await W(i,n);t&&(t.textContent=M(m),t.dataset.marioScore=String(m)),n&&(n.textContent=I(l),n.dataset.marioRank=String(l))}catch(i){console.warn("Unable to update Mario status bar",i)}}function B(){const t=(window==null?void 0:window.init)||{};return!t.userId&&!t.teamId?null:t.userMode==="teams"&&t.teamId?{account:"/api/v1/teams/me"}:{account:"/api/v1/users/me"}}async function z(t){var r,o;const n=d.get(t),e=Date.now();if(n&&n.data&&e-n.timestamp<y)return n.data;if(n&&n.promise)return n.promise;const a=A(t).then(s=>(d.set(t,{data:s,timestamp:Date.now(),promise:null}),s)).catch(s=>{const i=d.get(t)||{};throw d.set(t,{data:i.data||null,timestamp:i.timestamp||0,promise:null}),s});return d.set(t,{data:(r=n==null?void 0:n.data)!=null?r:null,timestamp:(o=n==null?void 0:n.timestamp)!=null?o:0,promise:a}),a}async function A(t){var a;const n=((a=window==null?void 0:window.CTFd)==null?void 0:a.fetch)||window.fetch;if(typeof n!="function")throw new Error("Fetch API unavailable");const e=await n(t,{credentials:"same-origin"});if(!e.ok)throw new Error(`Request failed: ${e.status}`);return e.json()}function M(t){return(Number.isFinite(t)?Math.max(0,Math.floor(t)):0).toString().padStart(6,"0")}function I(t){const n=Number.isFinite(t)?Math.max(0,Math.floor(t)):0;return n<=0?"#---":n>=1e3?`#${n}`:`#${n.toString().padStart(3,"0")}`}function G(t){var a,r,o,s,i;const n=(i=(o=(a=t==null?void 0:t.data)==null?void 0:a.place)!=null?o:(r=t==null?void 0:t.data)==null?void 0:r.rank)!=null?i:(s=t==null?void 0:t.data)==null?void 0:s.position,e=Number(n);return Number.isFinite(e)&&e>0?e:null}function H(t){var a,r;const n=(r=(a=t==null?void 0:t.dataset)==null?void 0:a.marioRank)!=null?r:0,e=Number(n);return Number.isFinite(e)?e:0}async function W(t,n){const e=G(t);if(e)return e;if(n){const a=await X(t);if(a)return a}return H(n)}async function X(t){var r;const n=Number((r=t==null?void 0:t.data)==null?void 0:r.id);if(!Number.isFinite(n)||n<=0)return null;let e;try{e=await Q()}catch(o){return console.warn("Unable to fetch scoreboard for rank fallback",o),null}if(!Array.isArray(e)||e.length===0)return null;const a=K(t);for(let o=0;o<e.length;o+=1){const s=e[o];if(!!s&&J(s,n,a))return o+1}return null}function J(t,n,e){const a=F((t==null?void 0:t.account_url)||(t==null?void 0:t.url)||"");return a&&e&&a===e?!0:[t==null?void 0:t.account_id,t==null?void 0:t.team_id,t==null?void 0:t.user_id,t==null?void 0:t.id].some(o=>Number(o)===n)}function K(t){var s,i,m;const n=Number((s=t==null?void 0:t.data)==null?void 0:s.id);if(!Number.isFinite(n)||n<=0)return null;const e=(window==null?void 0:window.init)||{},r=(e.userMode||((m=(i=C)==null?void 0:i.config)==null?void 0:m.userMode))==="teams"?"/teams":"/users",o=e.urlRoot||"";return F(`${o}${r}/${n}`)}function F(t){var n;if(typeof t!="string"||t.length===0)return null;try{return new URL(t,window.location.origin).pathname.replace(/\/+$/,"")}catch{const a=((n=window==null?void 0:window.init)==null?void 0:n.urlRoot)||"";return t.replace(a,"").replace(/\/+$/,"")}}async function Q(){const t=Date.now();if(Array.isArray(c.data)&&t-c.timestamp<D)return c.data;if(c.promise)return c.promise;const n=A("/api/v1/scoreboard").then(e=>{const a=Array.isArray(e==null?void 0:e.data)?e.data:[];return c.data=a,c.timestamp=Date.now(),c.promise=null,a}).catch(e=>{throw c.promise=null,e});return c.promise=n,n}window.CTFd=C;window.Alpine=b;b.start();
