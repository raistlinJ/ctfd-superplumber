import{C as F,m as L}from"./index.js";const y=""+new URL("coin.5eb58d7d.svg",import.meta.url).href,U=""+new URL("star.9c945d4c.svg",import.meta.url).href,V=""+new URL("mushroom.d116d1db.svg",import.meta.url).href,R=""+new URL("fire-flower.b4c5af98.svg",import.meta.url).href,q=10,E=5,j=1400,B=2600,W=12,N=[{name:"star",src:U,min:32,max:58},{name:"coin",src:y,min:30,max:48},{name:"mushroom",src:V,min:40,max:60},{name:"flower",src:R,min:36,max:56}],z=30*1e3,G=2*60*1e3,d=new Map,u={data:null,timestamp:0,promise:null};let C=!1,b=!1,l=null,m=null,h=null,w=null,f=0,p=0;const I=window.matchMedia("(prefers-reduced-motion: reduce)");function $(t){if("requestIdleCallback"in window){window.requestIdleCallback(t,{timeout:1200});return}window.setTimeout(t,0)}function H(){if(m&&document.body.contains(m))return m;const t=document.createElement("div");return t.className="superplumber-coin-container",document.body.appendChild(t),m=t,t}function M(t){const e=document.createElement("span");e.className="superplumber-coin",e.style.left=`${Math.random()*100}%`,e.style.bottom=`${Math.random()*-30}px`;const n=5+Math.random()*3;e.style.animationDuration=`${n}s`,t.appendChild(e),f+=1;const a=()=>{e.removeEventListener("animationend",a),e.remove(),f=Math.max(0,f-1)};e.addEventListener("animationend",a)}function A(t){const e=document.createElement("span");e.className="superplumber-star",e.style.left=`${Math.random()*100}%`,e.style.bottom=`${Math.random()*-40}px`;const n=6+Math.random()*4;e.style.animationDuration=`${n}s`,t.appendChild(e),p+=1;const a=()=>{e.removeEventListener("animationend",a),e.remove(),p=Math.max(0,p-1)};e.addEventListener("animationend",a)}function g(){h&&(window.clearInterval(h),h=null),w&&(window.clearInterval(w),w=null),m&&(m.remove(),m=null),f=0,p=0,C=!1}function x(t=!1){if(I.matches){g();return}if(C&&!t)return;t&&g(),C=!0;const e=H();for(let n=0;n<4;n+=1)M(e);for(let n=0;n<2;n+=1)A(e);h=window.setInterval(()=>{document.hidden||f<q&&M(e)},j),w=window.setInterval(()=>{document.hidden||p<E&&A(e)},B)}I.addEventListener("change",t=>{t.matches?(g(),_()):(b=!1,$(()=>{T(),x(!0)}))});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v,{once:!0}):v();function X(){if(l&&document.body.contains(l))return l;const t=document.createElement("div");return t.className="superplumber-floating-icons",document.body.appendChild(t),l=t,t}function _(){l&&(l.remove(),l=null),b=!1}function J(t){for(let e=0;e<20;e+=1){const n=8+Math.random()*74,a=4+Math.random()*92;if(!t.some(r=>{const s=r.left-a,i=r.top-n;return Math.sqrt(s*s+i*i)<10}))return{top:n,left:a}}return{top:10+Math.random()*70,left:6+Math.random()*88}}function T(){if(I.matches){_();return}if(b)return;b=!0;const t=X(),e=[],n=W;t.textContent="";for(let a=0;a<n;a+=1){const o=N[a%N.length],r=document.createElement("img");r.src=o.src,r.alt="",r.loading="lazy",r.decoding="async",r.className=`superplumber-floating-icon superplumber-floating-icon--${o.name}`;const s=o.min+Math.random()*(o.max-o.min);r.style.width=`${s}px`;const i=J(e);e.push(i),r.style.top=`${i.top}%`,r.style.left=`${i.left}%`;const c=7+Math.random()*6;r.style.animationDuration=`${c}s`,r.style.animationDelay=`${Math.random()*3}s`,t.appendChild(r)}}function v(){K(),$(()=>{T(),x()})}function K(){var a,o;const t=document.querySelector(".js-superplumber-score"),e=document.querySelector(".js-superplumber-rank");if(!t&&!e)return;if(!Boolean(((a=window==null?void 0:window.init)==null?void 0:a.userId)||((o=window==null?void 0:window.init)==null?void 0:o.teamId))){if(t){const r=Number(t.dataset.superplumberScore||0);t.textContent=O(r)}e&&(e.textContent=P(Number(e.dataset.superplumberRank||0)));return}Q(t,e)}async function Q(t,e){var a,o,r,s;const n=Y();if(!!n)try{const i=await Z(n.account),c=Number((s=(r=(a=i==null?void 0:i.data)==null?void 0:a.score)!=null?r:(o=t==null?void 0:t.dataset)==null?void 0:o.superplumberScore)!=null?s:0),S=await nt(i,e);t&&(t.textContent=O(c),t.dataset.superplumberScore=String(c)),e&&(e.textContent=P(S),e.dataset.superplumberRank=String(S))}catch(i){console.warn("Unable to update Superplumber status bar",i)}}function Y(){const t=(window==null?void 0:window.init)||{};return!t.userId&&!t.teamId?null:t.userMode==="teams"&&t.teamId?{account:"/api/v1/teams/me"}:{account:"/api/v1/users/me"}}async function Z(t){var o,r;const e=d.get(t),n=Date.now();if(e&&e.data&&n-e.timestamp<z)return e.data;if(e&&e.promise)return e.promise;const a=k(t).then(s=>(d.set(t,{data:s,timestamp:Date.now(),promise:null}),s)).catch(s=>{const i=d.get(t)||{};throw d.set(t,{data:i.data||null,timestamp:i.timestamp||0,promise:null}),s});return d.set(t,{data:(o=e==null?void 0:e.data)!=null?o:null,timestamp:(r=e==null?void 0:e.timestamp)!=null?r:0,promise:a}),a}async function k(t){var a;const e=((a=window==null?void 0:window.CTFd)==null?void 0:a.fetch)||window.fetch;if(typeof e!="function")throw new Error("Fetch API unavailable");const n=await e(t,{credentials:"same-origin"});if(!n.ok)throw new Error(`Request failed: ${n.status}`);return n.json()}function O(t){return(Number.isFinite(t)?Math.max(0,Math.floor(t)):0).toString().padStart(6,"0")}function P(t){const e=Number.isFinite(t)?Math.max(0,Math.floor(t)):0;return e<=0?"#---":e>=1e3?`#${e}`:`#${e.toString().padStart(3,"0")}`}function tt(t){var a,o,r,s,i;const e=(i=(r=(a=t==null?void 0:t.data)==null?void 0:a.place)!=null?r:(o=t==null?void 0:t.data)==null?void 0:o.rank)!=null?i:(s=t==null?void 0:t.data)==null?void 0:s.position,n=Number(e);return Number.isFinite(n)&&n>0?n:null}function et(t){var a,o;const e=(o=(a=t==null?void 0:t.dataset)==null?void 0:a.superplumberRank)!=null?o:0,n=Number(e);return Number.isFinite(n)?n:0}async function nt(t,e){const n=tt(t);if(n)return n;if(e){const a=await at(t);if(a)return a}return et(e)}async function at(t){var o;const e=Number((o=t==null?void 0:t.data)==null?void 0:o.id);if(!Number.isFinite(e)||e<=0)return null;let n;try{n=await it()}catch(r){return console.warn("Unable to fetch scoreboard for rank fallback",r),null}if(!Array.isArray(n)||n.length===0)return null;const a=ot(t);for(let r=0;r<n.length;r+=1){const s=n[r];if(!!s&&rt(s,e,a))return r+1}return null}function rt(t,e,n){const a=D((t==null?void 0:t.account_url)||(t==null?void 0:t.url)||"");return a&&n&&a===n?!0:[t==null?void 0:t.account_id,t==null?void 0:t.team_id,t==null?void 0:t.user_id,t==null?void 0:t.id].some(r=>Number(r)===e)}function ot(t){var s,i,c;const e=Number((s=t==null?void 0:t.data)==null?void 0:s.id);if(!Number.isFinite(e)||e<=0)return null;const n=(window==null?void 0:window.init)||{},o=(n.userMode||((c=(i=F)==null?void 0:i.config)==null?void 0:c.userMode))==="teams"?"/teams":"/users",r=n.urlRoot||"";return D(`${r}${o}/${e}`)}function D(t){var e;if(typeof t!="string"||t.length===0)return null;try{return new URL(t,window.location.origin).pathname.replace(/\/+$/,"")}catch{const a=((e=window==null?void 0:window.init)==null?void 0:e.urlRoot)||"";return t.replace(a,"").replace(/\/+$/,"")}}async function it(){const t=Date.now();if(Array.isArray(u.data)&&t-u.timestamp<G)return u.data;if(u.promise)return u.promise;const e=k("/api/v1/scoreboard").then(n=>{const a=Array.isArray(n==null?void 0:n.data)?n.data:[];return u.data=a,u.timestamp=Date.now(),u.promise=null,a}).catch(n=>{throw u.promise=null,n});return u.promise=e,e}window.CTFd=F;window.Alpine=L;L.start();
